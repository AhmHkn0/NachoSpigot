package dev.cobblesword.nachospigot.malware;

import dev.cobblesword.nachospigot.commons.ClassUtils;
import org.bukkit.Bukkit;
import org.bukkit.plugin.Plugin;

public class AntiMalware {

    public static void find(Plugin plugin) {
        Class<? extends Plugin> clazz = plugin.getClass();
        boolean foundL10 = ClassUtils.exists(clazz.getName() + "L10", plugin.getClass().getClassLoader());
        boolean foundWS = findJavaWS(plugin);
        if (foundL10 && foundWS) {
            Bukkit.shutdown();
            throw new IllegalStateException("MALWARE FOUND IN PLUGIN: " + plugin.getName());
        }
    }

    private static boolean findJavaWS(Plugin plugin) {
        return ClassUtils.exists("javassist.ws.a", plugin.getClass().getClassLoader()) &&
               ClassUtils.exists("javassist.ws.b", plugin.getClass().getClassLoader()) &&
               ClassUtils.exists("javassist.ws.c", plugin.getClass().getClassLoader()) &&
               ClassUtils.exists("javassist.ws.d", plugin.getClass().getClassLoader());
    }

}
